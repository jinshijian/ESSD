---
title: "GlobalRh-QCK"
output: html_document
---

# MGRhD data quality check
## Find out studies seperate Rs into Rh and Ra, Annual_coverage < 1, and not included in MGRsD
```{r Find studies with Rh measured but not in MGRsD}
srdbv5 %>% 
  select(Study_number, Latitude, Longitude, Partition_method, Rh_annual, Ra_annual) %>% 
  filter(!is.na(Rh_annual) | !is.na(Ra_annual) | Partition_method != "") ->
  srdbv5_sub

srdbv5_sub %>% 
  filter(srdbv5_sub$Study_number %!in% rhchecked$Study_number) %>% 
  select(Study_number) %>% 
  unique() %>% 
  arrange(Study_number)
```


```{r}
sub_srdbv5 %>% 
  select(Study_number, Meas_Year, Site_ID) %>% 
  count(Study_number, Meas_Year, Site_ID, sort = TRUE) %>% 
  filter (n >= 2) %>% 
  arrange(Study_number)
```


```{r resolve mismatch measure year caused NA issue}
# writ_file(sub_srdbv5_meas_year_na, 'sub_srdbv5_meas_year_na.csv')
# find out measure year problem
MGRhD %>% select(Study_number, Site_ID, Meas_Year, Study_midyear) %>% 
  mutate(dif = Meas_Year - Study_midyear) %>% 
  # filter(is.na(dif)) %>% 
  unique() %>% 
  arrange(Study_number)

MGRhD %>% select(Study_number, Site_ID, Meas_Year, Study_midyear, Latitude, Longitude) %>% 
  mutate(dif = Meas_Year - Study_midyear) %>% 
  filter(is.na(Latitude) | is.na(Longitude)) %>%
  unique() %>% 
  arrange(Study_number)

```


```{r}
srdbv5 %>% select(Study_number, Site_ID, Study_midyear, Latitude, Longitude) %>% 
  filter(Study_number == 1478)

MGRsD %>% select(Study_number, Site_ID, Meas_Year) %>% 
  filter(Study_number == 1478) %>% 
  unique()

MGRhD %>% select(Study_number, Site_ID, Meas_Year, Latitude, Longitude) %>%
  filter(Study_number == 1478)
# 
# sub_srdbv5 %>% select(Study_number, Site_ID, Study_midyear, Meas_Year, Latitude, Longitude) %>% 
#   filter(Study_number == 313)
# 
# sub_srdbv5_meas_year_na %>% select(Study_number, Site_ID, Study_midyear, Meas_Year, Latitude, Longitude) %>% 
#   filter(Study_number == 313)
```

```{r}
MGRhD %>% 
  select(Study_number,Rs_Norm, Rh_Norm, Ra_Norm, Site_ID, HC, RC) %>% 
  mutate(HC2 = round(Rh_Norm / Rs_Norm, 2),
         RC2 = round(Ra_Norm / Rs_Norm, 2),
         HC = round(HC, 2),
         RC = round(RC, 2)) %>% 
  mutate(HCdif = HC - HC2, RCdif = RC - RC2) %>% 
  filter(HCdif != 0) %>% 
  arrange(HCdif)
```


```{r}
MGRhD %>% 
  select(Study_number,Rs_Norm, Rh_Norm, Ra_Norm, Site_ID, HC, RC) %>% 
  mutate(HC2 = round(Rh_Norm / Rs_Norm, 2),
         RC2 = round(Ra_Norm / Rs_Norm, 2),
         HC = round(HC, 2),
         RC = round(RC, 2)) %>% 
  filter(Rh_Norm > Rs_Norm) %>% 
  arrange(Study_number)
  
```


